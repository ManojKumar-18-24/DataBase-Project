USE LIBRARY;

CREATE TABLE LITERATURE_CATEGORY (
    LITERATURE_ID INT,
    CATEGORY_NAME VARCHAR (30) NOT NULL,
    PRIMARY KEY(LITERATURE_ID)
);

-- LITERATURE_CATEGORY
INSERT INTO LITERATURE_CATEGORY (LITERATURE_ID, CATEGORY_NAME) VALUES
(1, 'Fiction'),
(2, 'Fantasy'),
(3, 'Science Fiction'),
(4, 'Mystery'),
(5, 'Thriller'),
(6, 'Romance'),
(7, 'Historical Fiction'),
(8, 'Horror'),
(9, 'Non-fiction'),
(10, 'Biography'),
(11, 'Memoir'),
(12, 'Self-help'),
(13, 'Poetry'),
(14, 'Drama'),
(15, 'Comedy');

SELECT * FROM LITERATURE_CATEGORY;

CREATE TABLE AUTHOR (
  AUTHOR_ID INT,
  AUTHORNAME VARCHAR (20) NOT NULL,
  DOB DATE,
  PRIMARY KEY(AUTHOR_ID)
);

-- AUTHOR
INSERT INTO AUTHOR (AUTHOR_ID, AUTHORNAME, DOB) VALUES
(1, 'Jane Austen', '1775-12-16'),
(2, 'William Shakespeare', '1564-04-23'),
(3, 'J.K. Rowling', '1965-07-31'),
(4, 'Mark Twain', '1835-11-30'),
(5, 'George Orwell', '1903-06-25'),
(6, 'Agatha Christie', '1890-09-15'),
(7, 'F. Scott Fitzgerald', '1896-09-24'),
(8, 'Stephen King', '1947-09-21'),
(9, 'Harper Lee', '1926-04-28'),
(10, 'J.R.R. Tolkien', '1892-01-03'),
(11, 'Ernest Hemingway', '1899-07-21'),
(12, 'Leo Tolstoy', '1828-09-09'),
(13, 'Charles Dickens', '1812-02-07'),
(14, 'Emily Bronte', '1818-07-30'),
(15, 'Virginia Woolf', '1882-01-25');

SELECT * FROM AUTHOR;

CREATE TABLE PUBLISHER (
   PUBLISHER_ID INT,
   PUBLISHER_NAME VARCHAR (30) NOT NULL,
   COUNTRY VARCHAR (20),
   ESTABLISHED_ON DATE, 
   PRIMARY KEY(PUBLISHER_ID)
);

-- PUBLISHER
INSERT INTO PUBLISHER (PUBLISHER_ID, PUBLISHER_NAME, COUNTRY, ESTABLISHED_ON) VALUES
(1, 'Penguin Random House', 'United States', '1927-07-01'),
(2, 'HarperCollins', 'United States', '1989-06-22'),
(3, 'Simon & Schuster', 'United States', '1924-04-01'),
(4, 'Macmillan Publishers', 'United Kingdom', '1843-09-01'),
(5, 'Hachette Livre', 'France', '1826-11-01'),
(6, 'Oxford University Press', 'United Kingdom', '1478-01-01'),
(7, 'Pearson Education', 'United Kingdom', '1844-01-01'),
(8, 'Bloomsbury Publishing', 'United Kingdom', '1986-01-01'),
(9, 'Wiley', 'United States', '1807-02-01'),
(10, 'Scholastic Corporation', 'United States', '1920-10-01'),
(11, 'Random House', 'United States', '1925-01-01'),
(12, 'Houghton Mifflin Harcourt', 'United States', '1832-01-01'),
(13, 'Pan Macmillan', 'Australia', '1843-01-01'),
(14, 'Harlequin Enterprises', 'Canada', '1949-01-01'),
(15, 'Cambridge University Press', 'United Kingdom', '1534-02-01'),
(16, 'Penguin India', 'India', '1985-02-01'),
(17, 'Rupa Publications', 'India', '1936-01-01'),
(18, 'SAGE Publications', 'India', '1965-01-01');

SELECT * FROM PUBLISHER;

-- drop table books;
CREATE TABLE BOOKS (
   ISBN VARCHAR (13),
   BOOK_TITLE VARCHAR (50) NOT NULL,
   PAGES INT,
   EDITION INT,
   PUBLISHED_YEAR INT,
   LITERATURE_ID INT NOT NULL,
   PRIMARY KEY(ISBN),
   FOREIGN KEY (LITERATURE_ID) REFERENCES LITERATURE_CATEGORY(LITERATURE_ID)
);

-- BOOKS
INSERT INTO BOOKS (ISBN, BOOK_TITLE, PAGES, EDITION, PUBLISHED_YEAR, LITERATURE_ID) VALUES ('9780142437208', 'Pride and Prejudice', 279, 1, 1813, 1), 
('9780743273564', 'The Great Gatsby', 180, 2, 1925, 2),
 ('9780439136365', 'Harry Potter and the Sorcerers Stone', 320, 1, 1997, 3), 
('9780061120084','To Kill a Mockingbird', 324, 1, 1960, 4),
 ('9780451524935', '1984', 328, 1, 1949, 5),
 ('9780007117116', 'The Hobbit', 310, 1, 1937, 6),
 ('9780062073488', 'The Catcher in the Rye', 277, 1, 1951, 7),
 ('9780544003415', 'The Lord of the Rings', 1178, 1, 1954, 8), 
('9780684801469', 'The Old Man and the Sea', 127, 1, 1952, 9),
 ('9780062024688', 'The Alchemist', 197, 1, 1988, 10), 
('9781853262400', 'Anna Karenina', 864, 1, 1878, 11), 
('9780143128542', 'A Tale of Two Cities', 489, 1, 1859, 12),
 ('9780141439471', 'A Tale of Two Cities', 416, 2, 1867, 12), 
('9780151008121', 'Mrs. Dalloway', 194, 1, 1925, 14), 
('9780316015844', 'Twilight', 498, 1, 2005, 2), 
('9780140183526', 'The Lightning Thief', 720, 1, 1851, 3),
 ('9780375831003', 'The Lightning Thief', 377, 2, 2005, 3),
 ('9780064401883', 'Matilda', 240, 1, 1988, 4), 
('9780451527745', 'Dracula', 418, 1, 1897, 5),
 ('9780143131207', 'Slaughterhouse-Five', 275, 1, 1969, 6), 
('9780140449334', 'Slaughterhouse-Five ', 671, 2, 2000, 6),
 ('9780062699168', 'The Night Circus', 400, 1, 2011, 8),
 ('9780140187395', 'Jane Eyre', 507, 1, 1847, 9), 
('9780345339683', 'Fahrenheit 451', 249, 1, 1953, 3),
 ('9780679783268', 'Memoirs of a Geisha', 434, 1, 1997, 10), 
('9780451528551', 'The Picture of Dorian Gray', 254, 1, 1890, 12),
 ('9780062081551', 'The Help', 544, 1, 2009, 13),
 ('9781400032804', 'The Kite Runner', 371, 1, 2003, 12),
 ('9780140449335', 'Pride and Prejudice', 279, 2, 1832, 1),
 ('9780743273565', 'The Great Gatsby', 180, 3, 1953, 2),
 ('9780142437209', 'Pride and Prejudice', 279, 3, 1892, 1);
 
 SELECT * FROM BOOKS;
 
 
CREATE TABLE WRITTEN_BY (
AUTHOR_ID INT NOT NULL,
ISBN VARCHAR (13),
FOREIGN KEY (AUTHOR_ID) REFERENCES AUTHOR(AUTHOR_ID),
FOREIGN KEY (ISBN) REFERENCES BOOKS(ISBN)
);

-- WRITTEN BY
INSERT INTO WRITTEN_BY (AUTHOR_ID, ISBN) VALUES
(1,'9780142437208'),
(1, '9780142437209'),
(2, '9780743273564'),
(3, '9780439136365'),
(4, '9780061120084'),
(5, '9780451524935'),
(6, '9780007117116'),
(7, '9780062073488'),
(8, '9780544003415'),
(9, '9780684801469'),
(10, '9780062024688'),
(11, '9781853262400'),
(12, '9780143128542'),
(13, '9780141439471'),
(14, '9780151008121'),
(15, '9780316015844'),
(15, '9780142437209'),
(14, '9780743273565'),
(13, '9780439136365'),
(12, '9780061120084'),
(11, '9780451524935'),
(10, '9780007117116'),
(9, '9780062073488'),
(1, '9780544003415'),
(7, '9780684801469'),
(6, '9780062024688'),
(5, '9781853262400'),
(4, '9780143128542'),
(3, '9780141439471'),
(2, '9780151008121'),
(1, '9780316015844'),
(9,'9780140449335');
INSERT INTO WRITTEN_BY (AUTHOR_ID, ISBN) VALUES
(1, '9780140183526'),
(2, '9780375831003'),
(3, '9780064401883'),
(4, '9780451527745'),
(5, '9780143131207'),
(6, '9780140449334'),
(7, '9780062699168'),
(8, '9780140187395'),
(9, '9780345339683'),
(10, '9780679783268'),
(11, '9780451528551'),
(12, '9780062081551'),
(13, '9781400032804'),
(14, '9780140449334'),
(15, '9780743273565');

SELECT * FROM WRITTEN_BY ;


CREATE TABLE PUBLISHING (
ISBN VARCHAR (13),
PUBLISHER_ID INT ,
FOREIGN KEY (ISBN) REFERENCES BOOKS(ISBN),
FOREIGN KEY (PUBLISHER_ID) REFERENCES PUBLISHER(PUBLISHER_ID)
);

-- PUBLISHING
INSERT INTO PUBLISHING (ISBN, PUBLISHER_ID) VALUES
('9780142437208',1),
('9780142437209', 1),
('9780743273565', 2),
('9780439136365', 3),
('9780061120084', 4),
('9780451524935', 5),
('9780007117116', 6),
('9780062073488', 7),
('9780544003415', 8),
('9780684801469', 9),
('9780062024688', 10),
('9781853262400', 11),
('9780143128542', 12),
('9780141439471', 13),
('9780151008121', 14),
('9780316015844', 15),
('9780140183526', 1),
('9780375831003', 2),
('9780064401883', 3),
('9780451527745', 4),
('9780143131207', 5);
INSERT INTO PUBLISHING (ISBN, PUBLISHER_ID) VALUES
('9780140187395', 6),
('9780345339683', 7),
('9780679783268', 8),
('9780451528551', 9),
('9780062081551', 10);

SELECT * FROM PUBLISHING;

CREATE TABLE MEMBERS (
   MEMBER_ID INT,
   EMAIL VARCHAR (30),
   NAME  VARCHAR (20) NOT NULL,
   STREET VARCHAR (20),
   CITY  VARCHAR (20),
   PRIMARY KEY(MEMBER_ID)	
);

-- MEMBERS
INSERT INTO MEMBERS (MEMBER_ID, EMAIL, NAME, STREET, CITY) VALUES
(1, 'john@gmail.com', 'John Doe', '123 Main St', 'New York'),
(2, 'alice@gmail.com', 'Alice Smith', '456 Elm St', 'Los Angeles'),
(3, 'michael@gmail.com', 'Michael Johnson', '789 Oak St', 'Chicago'),
(4, 'emily@gmail.com', 'Emily Brown', '101 Pine St', 'Houston'),
(5, 'david@gmail.com', 'David Lee', '234 Maple St', 'Phoenix'),
(6, 'emma@gmail.com', 'Emma Wilson', '567 Cedar St', 'Philadelphia'),
(7, 'james@gmail.com', 'James Taylor', '890 Walnut St', 'San Antonio'),
(8, 'olivia@gmail.com', 'Olivia Martinez', '111 Birch St', 'San Diego'),
(9, 'william@gmail.com', 'William Anderson', '222 Spruce St', 'Dallas'),
(10, 'sophia@gmail.com', 'Sophia Rodriguez', '333 Fir St', 'San Jose'),
(11, 'daniel@gmail.com', 'Daniel Hernandez', '444 Cedar St', 'Austin'),
(12, 'isabella@gmail.com', 'Isabella Garcia', '555 Elm St', 'Jacksonville'),
(13, 'alexander@gmail.com', 'Alexander Lopez', '666 Oak St', 'Indianapolis'),
(14, 'mia@gmail.com', 'Mia Gonzalez', '777 Maple St', 'San Francisco'),
(15, 'matthew@gmail.com', 'Matthew Perez', '888 Pine St', 'Columbus'),
(16, 'charlotte@gmail.com', 'Charlotte Turner', '999 Cedar St', 'Fort Worth'),
(17, 'ethan@gmail.com', 'Ethan Moore', '1010 Elm St', 'Charlotte'),
(18, 'amelia@gmail.com', 'Amelia Hill', '1111 Oak St', 'Detroit'),
(19, 'benjamin@gmail.com', 'Benjamin Ward', '1212 Maple St', 'Seattle'),
(20, 'ava@gmail.com', 'Ava Brooks', '1313 Pine St', 'Denver');

SELECT * FROM MEMBERS;

CREATE TABLE PHONENUMBER(
   MEMBER_ID INT NOT NULL,
   PHONE1 BIGINT NOT NULL,
   PHONE2 BIGINT,
   FOREIGN KEY(MEMBER_ID) REFERENCES MEMBERS(MEMBER_ID)
);

-- PHONENUMBER
INSERT INTO PHONENUMBER (MEMBER_ID, PHONE1, PHONE2) VALUES
(1, 1234567890, 9876543210),
(2, 2345678901, 8765432109),
(3, 3456789012, 7654321098),
(4, 4567890123, 6543210987),
(5, 5678901234, 5432109876),
(6, 6789012345, 4321098765),
(7, 7890123456, 3210987654),
(8, 8901234567, 2109876543),
(9, 9012345678, 1098765432),
(10, 9876543210, 1234567890),
(11, 8765432109, 2345678901),
(12, 7654321098, 3456789012),
(13, 6543210987, 4567890123),
(14, 5432109876, 5678901234),
(15, 4321098765, 6789012345),
(16, 3210987654, 7890123456),
(17, 2109876543, 8901234567),
(18, 1098765432, 9012345678),
(19, 1234567890, NULL),
(20, 9876543210, NULL);

SELECT * FROM PHONENUMBER;

CREATE TABLE BOOKITEM (
  BOOK_ID VARCHAR (20) PRIMARY KEY,
  ISBN VARCHAR (13) NOT NULL,
  UNIQUE (BOOK_ID),
  FOREIGN KEY(ISBN) REFERENCES BOOKS(ISBN)
);

-- BOOKITEM
INSERT INTO BOOKITEM (BOOK_ID, ISBN) VALUES
('B001', '9780142437209'),
('B002', '9780743273564'),
('B003', '9780439136365'),
('B004', '9780061120084'),
('B005', '9780451524935'),
('B006', '9780007117116'),
('B007', '9780062073488'),
('B008', '9780544003415'),
('B009', '9780684801469'),
('B010', '9780062024688'),
('B011', '9781853262400'),
('B012', '9780143128542'),
('B013', '9780141439471'),
('B014', '9780151008121'),
('B015', '9780316015844'),
('B016', '9780140183526'),
('B017', '9780375831003'),
('B018', '9780064401883'),
('B019', '9780451527745'),
('B020', '9780143131207'),
('B021', '9780140449334'),
('B022', '9780062699168'),
('B023', '9780140187395'),
('B024', '9780345339683'),
('B025', '9780679783268'),
('B026', '9780451528551'),
('B027', '9780062081551'),
('B028', '9781400032804'),
('B029', '9780140449334'),
('B030', '9780743273565'),
('B031', '9780142437208'),
('B032', '9780142437209'),
('B033', '9780743273565'),
('B034', '9780439136365'),
('B035', '9780061120084'),
('B045', '9780451524935'),
('B046', '9780007117116'),
('B047', '9780062073488'),
('B048', '9780544003415'),
('B049', '9780684801469'),
('B110', '9780062024688'),
('B111', '9781853262400'),
('B112', '9780143128542'),
('B113', '9780141439471'),
('B114', '9780151008121'),
('B115', '9780316015844'),
('B116', '9780140183526'),
('B117', '9780375831003'),
('B118', '9780064401883'),
('B119', '9780451527745'),
('B120', '9780143131207'),
('B121', '9780140449334'),
('B122', '9780062699168'),
('B123', '9780140187395'),
('B124', '9780345339683'),
('B125', '9780679783268'),
('B126', '9780451528551'),
('B127', '9780062081551'),
('B128', '9781400032804'),
('B129', '9780140449334'),
('B130', '9780743273565'),
('B131', '9780142437209');

SELECT * FROM BOOKITEM;

CREATE TABLE LOANED_BOOK (
    LOANEDBOOK_ID VARCHAR (20) PRIMARY KEY,
    DATE_LOANED DATE NOT NULL,
    DATE_RETURNED DATE ,
	DAYS_LIMIT INT,
    MEMBER_ID INT NOT NULL,
    BOOK_ID VARCHAR (20) UNIQUE NOT NULL,
   FOREIGN KEY(MEMBER_ID) REFERENCES MEMBERS(MEMBER_ID),
   FOREIGN KEY(BOOK_ID) REFERENCES BOOKITEM(BOOK_ID)
);

-- LOANED_BOOK
	INSERT INTO LOANED_BOOK (LOANEDBOOK_ID, DATE_LOANED, DATE_RETURNED, DAYS_LIMIT, MEMBER_ID, BOOK_ID) VALUES
('LB001', '2024-03-01', '2024-03-10', 10, 6, 'B001'),
('LB002', '2024-03-02', '2024-03-12', 10, 6, 'B002'),
('LB003', '2024-03-03', '2024-03-14', 10, 6, 'B003'),
('LB004', '2024-03-04', '2024-03-16', 10, 1, 'B004'),
('LB005', '2024-03-05', '2024-03-18', 10, 2, 'B005'),
('LB006', '2024-03-06', '2024-03-20', 10, 3, 'B006'),
('LB007', '2024-03-07', '2024-03-22', 10, 3, 'B007'),
('LB008', '2024-03-08', '2024-03-24', 10, 3, 'B008'),
('LB009', '2024-03-09', '2024-03-26', 10, 9, 'B009'),
('LB010', '2024-03-10', '2024-03-28', 10, 10, 'B010'),
('LB011', '2024-03-11', '2024-03-30', 10, 11, 'B011'),
('LB012', '2024-03-12', '2024-04-01', 10, 12, 'B012'),
('LB013', '2024-03-13', NULL, 10, 13, 'B013'),
('LB014', '2024-03-14', NULL, 10, 14, 'B014'),
('LB115', '2024-03-15', NULL, 10, 5, 'B115'),
('LB116', '2024-03-16', NULL, 10, 4, 'B116'),
('LB117', '2024-03-17', NULL, 10, 4, 'B117'),
('LB118', '2024-03-18', NULL, 10, 4, 'B118'),
('LB119', '2024-03-19', NULL, 10, 4, 'B119'),
('LB120', '2024-03-20', NULL, 10, 9, 'B120'),
('LB121', '2024-03-21', NULL, 10, 9, 'B121'),
('LB122', '2024-03-22', NULL, 10, 9, 'B122'),
('LB123', '2024-03-23', NULL, 10, 9, 'B123'),
('LB124', '2024-03-24', NULL, 10, 9, 'B124'),
('LB125', '2024-03-25', NULL, 10, 11, 'B125'),
('LB126', '2024-03-26', NULL, 10, 11, 'B126'),
('LB127', '2024-03-27', NULL, 10, 11, 'B127'),
('LB128', '2024-03-28', NULL, 10, 14, 'B128'),
('LB129', '2024-03-29', NULL, 10, 14, 'B129'),
('LB130', '2024-03-30', NULL, 10, 14, 'B130');

SELECT * FROM LOANED_BOOK;
select count(isbn) from books group by book_title;-- NO. OF EDITION OF DIFF BOOKS
select authorname from author where author_id in (select author_id from books natural join written_by where author_id=1); -- AUTHOR FOR A BOOK
select count(book_id) from bookitem group by isbn;-- NO OF COPIES
SELECT count(loanedbook_id) from loaned_book group by member_id; -- NO OF BOOKS TAKEN BY A              --USER 

-- Total Number of Books Loaned by Each Member:
SELECT AVG(books_taken) AS AVG_BOOKS_TAKEN
FROM (SELECT MEMBER_ID, COUNT(LOANEDBOOK_ID) AS books_taken
      FROM LOANED_BOOK
      GROUP BY MEMBER_ID) AS member_books;

SELECT MEMBER_ID, COUNT(LOANEDBOOK_ID) AS NUM_BOOKS_TAKEN FROM LOANED_BOOK GROUP BY MEMBER_ID;

-- Total Number of Books Loaned on Each Day:
SELECT DATE_LOANED, COUNT(LOANEDBOOK_ID) AS NUM_BOOKS_LOANED FROM LOANED_BOOK GROUP BY DATE_LOANED;

SELECT AVG(books_taken) AS AVG_BOOKS_TAKEN
FROM (SELECT MEMBER_ID, COUNT(LOANEDBOOK_ID) AS books_taken
      FROM LOANED_BOOK
      GROUP BY MEMBER_ID) AS member_books; 

-- Number of Books Loaned by Each Publisher:
SELECT PUBLISHER.PUBLISHER_NAME, COUNT(LOANEDBOOK_ID) AS NUM_BOOKS_LOANED
FROM LOANED_BOOK
JOIN BOOKITEM ON LOANED_BOOK.BOOK_ID = BOOKITEM.BOOK_ID
JOIN BOOKS ON BOOKITEM.ISBN = BOOKS.ISBN
JOIN PUBLISHING ON BOOKS.ISBN = PUBLISHING.ISBN
JOIN PUBLISHER ON PUBLISHING.PUBLISHER_ID = PUBLISHER.PUBLISHER_ID
GROUP BY PUBLISHER.PUBLISHER_NAME;

-- Number of Books Loaned by Each Author:
SELECT AUTHOR.AUTHORNAME, COUNT(LOANEDBOOK_ID) AS NUM_BOOKS_LOANED
FROM LOANED_BOOK
JOIN BOOKITEM ON LOANED_BOOK.BOOK_ID = BOOKITEM.BOOK_ID
JOIN BOOKS ON BOOKITEM.ISBN = BOOKS.ISBN
JOIN WRITTEN_BY ON BOOKS.ISBN = WRITTEN_BY.ISBN
JOIN AUTHOR ON WRITTEN_BY.AUTHOR_ID = AUTHOR.AUTHOR_ID
GROUP BY AUTHOR.AUTHORNAME;

-- Number of Books Loaned in Each Genre:
SELECT LITERATURE_CATEGORY.CATEGORY_NAME, COUNT(LOANEDBOOK_ID) AS NUM_BOOKS_LOANED
FROM LOANED_BOOK
JOIN BOOKITEM ON LOANED_BOOK.BOOK_ID = BOOKITEM.BOOK_ID
JOIN BOOKS ON BOOKITEM.ISBN = BOOKS.ISBN
JOIN LITERATURE_CATEGORY ON BOOKS.LITERATURE_ID = LITERATURE_CATEGORY.LITERATURE_ID
GROUP BY LITERATURE_CATEGORY.CATEGORY_NAME;

-- Number of Books Loaned by Each Country's Publisher:
SELECT PUBLISHER.COUNTRY, COUNT(LOANEDBOOK_ID) AS NUM_BOOKS_LOANED
FROM LOANED_BOOK
JOIN BOOKITEM ON LOANED_BOOK.BOOK_ID = BOOKITEM.BOOK_ID
JOIN BOOKS ON BOOKITEM.ISBN = BOOKS.ISBN
JOIN PUBLISHING ON BOOKS.ISBN = PUBLISHING.ISBN
JOIN PUBLISHER ON PUBLISHING.PUBLISHER_ID = PUBLISHER.PUBLISHER_ID
GROUP BY PUBLISHER.COUNTRY;

-- Number of Books Loaned with Edition Information:
SELECT BOOKS.BOOK_TITLE, BOOKS.EDITION, COUNT(LOANEDBOOK_ID) AS NUM_BOOKS_LOANED
FROM LOANED_BOOK
JOIN BOOKITEM ON LOANED_BOOK.BOOK_ID = BOOKITEM.BOOK_ID
JOIN BOOKS ON BOOKITEM.ISBN = BOOKS.ISBN
GROUP BY BOOKS.BOOK_TITLE, BOOKS.EDITION;
-- Number of Books Loaned by Each Member with Multiple Loan Transactions:
SELECT MEMBER_ID, COUNT(DISTINCT LOANEDBOOK_ID) AS NUM_BOOKS_TAKEN
FROM LOANED_BOOK
GROUP BY MEMBER_ID
HAVING COUNT(LOANEDBOOK_ID) > 1;
